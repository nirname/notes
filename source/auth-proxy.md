# Авторизационный proxy

Идея очень простая и уже очень давно много где реализована.

Ваше приложение находится на одном домене, скажем example.com, и вы хотите
сделать так, чтобы другие ваши приложения, например app.example.com
авторизовывало пользователя, если он уже авторизован на example.com.

Чтобы одно приложение авторизовывало другое можно использовать oauth.
Можно использовать те же самые [cookie для поддоменов](cookie-sharing.md), что и для основного,
но если они зашифрованы / подписаны, то надо будет раскладывать ключи по каждому проекту.
Дело усложнится, если это проекты написанные на разных языках.
Также, внутри каждого проекта придётся писать свою аутентификацию.

Гораздо проще дела обстоят если все ваши проекты находятся за одним прокси сервером.
От shared cookie не избавиться, но можно полностью возложить аутентификацию на proxy.

Аутентификационный запрос должен возвращать 401 или 200.

Если пользователь не авторизован, то можно 401 превратить в 302 и направить его на форму входа.

```seqdiag
seqdiag {
  browser -> proxy [label = "app.example.com"] {
    proxy -> example.com [label = "auth request"];
    proxy <-- example.com [label = "401"];
  }
  browser <- proxy [label = "302 to example.com login"];
  browser -> proxy -> example.com [label = "example.com/login"];
}
```

Если пользователь авторизован, то схема выглядит так:

```seqdiag
seqdiag {
  browser => proxy [label = "app.example.com"] {
    proxy -> example.com [label = "auth request"];
    proxy <-- example.com [label = "200"];
    proxy => app.example.com;
  }
}
```

[Назад](index.md)